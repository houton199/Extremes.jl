<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorial · Extremes.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="Extremes.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit">Extremes.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Extreme value analysis in Julia.</a></li><li class="is-active"><a class="tocitem" href>Tutorial</a><ul class="internal"><li><a class="tocitem" href="#Model-for-stationary-block-maxima-1"><span>Model for stationary block maxima</span></a></li><li><a class="tocitem" href="#Model-for-stationary-threshold-exceedances-1"><span>Model for stationary threshold exceedances</span></a></li><li><a class="tocitem" href="#Model-for-dependent-data-1"><span>Model for dependent data</span></a></li><li><a class="tocitem" href="#Model-for-non-stationary-data-1"><span>Model for non-stationary data</span></a></li></ul></li><li><a class="tocitem" href="../contributing/">Contributing</a></li><li><a class="tocitem" href="../functions/">Functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jojal5/Extremes.jl/blob/master/docs/src/getting_started.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Tutorial-1"><a class="docs-heading-anchor" href="#Tutorial-1">Tutorial</a><a class="docs-heading-anchor-permalink" href="#Tutorial-1" title="Permalink"></a></h1><p>This tutorial shows the functionalities of <em>Extremes.jl</em>. They are illustrated by reproducing some of the results shown by Coles (2001) in <a href="http://www.springer.com/us/book/9781852334598">An Introduction to Statistical Modeling of Extreme  Values</a>.</p><p>Before executing this tutorial, make sure to have installed the following packages:</p><ul><li><em>Extremes.jl</em> (of course)</li><li><em>DataFrames.jl</em> (for using the DataFrame type)</li><li><em>Distributions.jl</em> (for using probability distribution objects)</li><li><em>Gadfly.jl</em> (for plotting)</li></ul><p>and import them using the following command:</p><pre><code class="language-julia-repl">julia&gt; using Extremes, DataFrames, Distributions, Gadfly
ERROR: ArgumentError: Package Distributions not found in current path:
- Run `import Pkg; Pkg.add(&quot;Distributions&quot;)` to install the Distributions package.</code></pre><h2 id="Model-for-stationary-block-maxima-1"><a class="docs-heading-anchor" href="#Model-for-stationary-block-maxima-1">Model for stationary block maxima</a><a class="docs-heading-anchor-permalink" href="#Model-for-stationary-block-maxima-1" title="Permalink"></a></h2><h3 id="Port-Pirie-example-1"><a class="docs-heading-anchor" href="#Port-Pirie-example-1">Port Pirie example</a><a class="docs-heading-anchor-permalink" href="#Port-Pirie-example-1" title="Permalink"></a></h3><p>This section concerns the annual maximum sea-levels recorded at Port Pirie, South Australia, from 1923 to 1987. This dataset were studied by Coles(2001) in Chapter 3.</p><h4 id="Load-the-data-1"><a class="docs-heading-anchor" href="#Load-the-data-1">Load the data</a><a class="docs-heading-anchor-permalink" href="#Load-the-data-1" title="Permalink"></a></h4><p>Loading the annual maximum sea-levels at Port Pirie:</p><pre><code class="language-julia">data = load(&quot;portpirie&quot;)
first(data,5)</code></pre><table class="data-frame"><thead><tr><th></th><th>Year</th><th>SeaLevel</th></tr><tr><th></th><th>Int64</th><th>Float64</th></tr></thead><tbody><p>5 rows × 2 columns</p><tr><th>1</th><td>1923</td><td>4.03</td></tr><tr><th>2</th><td>1924</td><td>3.83</td></tr><tr><th>3</th><td>1925</td><td>3.65</td></tr><tr><th>4</th><td>1926</td><td>3.88</td></tr><tr><th>5</th><td>1927</td><td>4.01</td></tr></tbody></table><p>Plotting the data using the Gadfly package:</p><pre><code class="language-">plot(data, x=:Year, y=:SeaLevel, Geom.line)</code></pre><h4 id="GEV-parameters-estimation-1"><a class="docs-heading-anchor" href="#GEV-parameters-estimation-1">GEV parameters estimation</a><a class="docs-heading-anchor-permalink" href="#GEV-parameters-estimation-1" title="Permalink"></a></h4><p>In this example, the Generalized Extreme Value distribution is fitted by maximum likelihood to the annual maximum sea-levels at Port-Pirie.</p><p>The data have been loaded in a <em>DataFrame</em>. The function <code>gevfit</code> can be called directly using the dataframe as the first argument and the data column symbol as the second argument as follows:</p><pre><code class="language-julia-repl">julia&gt; fm = gevfit(data, :SeaLevel)
MaximumLikelihoodEVA
model :
	BlockMaxima
	data :		Array{Float64,1}[65]
	location :	μ ~ 1
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

θ̂  :	[3.874750223091266, -1.6192723640210762, -0.05010719929448139]</code></pre><p>The function <a href="../functions/#Extremes.gevfit-Tuple{Array{#s14,1} where #s14&lt;:Real,Array{#s13,1} where #s13&lt;:Real}"><code>gevfit</code></a> returns a MaximumLikelihoodEVA object which contains:</p><ul><li>the structure name indicating in particular the estimation method (maximum likelihood in this example);</li><li>the statistical model (the stationary block maxima model in this example);</li><li>the location, log-scale and shape parameter estimates respectively in the vector $ θ̂ $.</li></ul><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The function returns the estimates of the log-scale parameter <span>$\phi = \log \sigma$</span>.</p></div></div><h4 id="Diagnostics-plots-1"><a class="docs-heading-anchor" href="#Diagnostics-plots-1">Diagnostics plots</a><a class="docs-heading-anchor-permalink" href="#Diagnostics-plots-1" title="Permalink"></a></h4><pre><code class="language-none">TODO</code></pre><h4 id="Return-level-estimation-1"><a class="docs-heading-anchor" href="#Return-level-estimation-1">Return level estimation</a><a class="docs-heading-anchor-permalink" href="#Return-level-estimation-1" title="Permalink"></a></h4><p><em>T</em>-year return level estimate can be obtained using the function <a href="../functions/#Extremes.returnlevel"><code>returnlevel</code></a> on a <code>fittedEVA</code> object. The first argument is the fitted model, the second is the return period in years and the last one is the confidence level for computing the confidence interval.</p><p>For example, the 100-year return level for the Port Pirie data and the corresponding 95% confidence interval can be obtained with this commands:</p><pre><code class="language-julia-repl">julia&gt; r = returnlevel(fm, 100, .95)
ReturnLevel(MaximumLikelihoodEVA
model :
	BlockMaxima
	data :		Array{Float64,1}[65]
	location :	μ ~ 1
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

θ̂  :	[3.874750223091266, -1.6192723640210762, -0.05010719929448139]
, 100, [4.688403360432851], [[4.377121171613511, 4.999685549252191]])</code></pre><p>where the value can be accessed with</p><pre><code class="language-julia-repl">julia&gt; r.value
1-element Array{Float64,1}:
 4.688403360432851</code></pre><p>and where the corresponding confidence interval can be accessed with</p><pre><code class="language-julia-repl">julia&gt; r.cint
1-element Array{Array{Float64,1},1}:
 [4.377121171613511, 4.999685549252191]</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In this example of a stationary model, the function returns a unit dimension vector for the return level and a vector containing only one vector for the confidence interval. The reason is that the function always returns the same type in the stationary and non-stationary case. The function is therefore <a href="https://docs.julialang.org/en/v1/manual/performance-tips/index.html#Write-%22type-stable%22-functions-1">type-stable</a> allowing better performance of code execution.  </p></div></div><p>To get the scalar return level in the stationary case, the following command can be used:</p><pre><code class="language-julia-repl">julia&gt; r.value[]
4.688403360432851</code></pre><p>To get the scalar confidence interval in the stationary case, the following command can be used:</p><pre><code class="language-julia-repl">julia&gt; r.cint[]
2-element Array{Float64,1}:
 4.377121171613511
 4.999685549252191</code></pre><h4 id="Probability-weighted-moments-estimation-1"><a class="docs-heading-anchor" href="#Probability-weighted-moments-estimation-1">Probability weighted moments estimation</a><a class="docs-heading-anchor-permalink" href="#Probability-weighted-moments-estimation-1" title="Permalink"></a></h4><p>Probability weighted moments estimation of the GEV parameters can also be performed by using the <a href="../functions/#Extremes.gevfitpwm-Tuple{Array{#s67,1} where #s67&lt;:Real}"><code>gevfitpwm</code></a> function. All the methods also apply to the <code>pwmEVA</code> object.</p><pre><code class="language-julia-repl">julia&gt; fm = gevfitpwm(data[:,:SeaLevel])
pwmEVA
model :
	BlockMaxima
	data :		Array{Float64,1}[65]
	location :	μ ~ 1
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

θ̂  :	[3.8731723562720766, -1.5932320395836068, -0.051477125862911276]</code></pre><h4 id="Bayesian-estimation-1"><a class="docs-heading-anchor" href="#Bayesian-estimation-1">Bayesian estimation</a><a class="docs-heading-anchor-permalink" href="#Bayesian-estimation-1" title="Permalink"></a></h4><p>Bayesian estimation of the GEV parameters can also be performed by using the <a href="../functions/#Extremes.gevfitbayes-Tuple{Array{#s15,1} where #s15&lt;:Real}"><code>gevfitbayes</code></a> function. All the methods also apply to the `BayesianEVA object.</p><pre><code class="language-julia-repl">julia&gt; fm = gevfitbayes(data[:,:SeaLevel])
Progress:   0%|                                         |  ETA: 0:22:16[KProgress:  13%|█████▎                                   |  ETA: 0:00:04[KProgress:  18%|███████▌                                 |  ETA: 0:00:03[KProgress:  26%|██████████▌                              |  ETA: 0:00:02[KProgress:  32%|█████████████                            |  ETA: 0:00:02[KProgress:  39%|███████████████▉                         |  ETA: 0:00:02[KProgress:  40%|████████████████▍                        |  ETA: 0:00:02[KProgress:  46%|███████████████████                      |  ETA: 0:00:01[KProgress:  53%|█████████████████████▉                   |  ETA: 0:00:01[KProgress:  59%|████████████████████████▍                |  ETA: 0:00:01[KProgress:  66%|███████████████████████████▎             |  ETA: 0:00:01[KProgress:  73%|██████████████████████████████           |  ETA: 0:00:01[KProgress:  80%|████████████████████████████████▊        |  ETA: 0:00:00[KProgress:  86%|███████████████████████████████████▍     |  ETA: 0:00:00[KProgress:  93%|██████████████████████████████████████▎  |  ETA: 0:00:00[KProgress: 100%|████████████████████████████████████████▉|  ETA: 0:00:00[KProgress: 100%|█████████████████████████████████████████| Time: 0:00:02[K
BayesianEVA
model :
	BlockMaxima
	data :		Array{Float64,1}[65]
	location :	μ ~ 1
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

sim :	Mamba.Chains</code></pre><h2 id="Model-for-stationary-threshold-exceedances-1"><a class="docs-heading-anchor" href="#Model-for-stationary-threshold-exceedances-1">Model for stationary threshold exceedances</a><a class="docs-heading-anchor-permalink" href="#Model-for-stationary-threshold-exceedances-1" title="Permalink"></a></h2><p>The data of this section come from Chapter 4 of Coles (2001) and correspond to the daily rainfall accumulations at a location in south-west England from 1914 to 1962.</p><h4 id="Load-the-data-2"><a class="docs-heading-anchor" href="#Load-the-data-2">Load the data</a><a class="docs-heading-anchor-permalink" href="#Load-the-data-2" title="Permalink"></a></h4><p>Loading the daily rainfall at a location in South-England:</p><pre><code class="language-">data = load(&quot;rain&quot;)
x = collect(Date(1914,1,1):Day(1):Date(1961,12,30))
data[!,:Date] = x
select!(data, [:Date, :Rainfall])
first(data,5)</code></pre><p>Plotting the data using the Gadfly package:</p><pre><code class="language-">plot(data, x=:Date, y=:Rainfall, Geom.point, Theme(discrete_highlight_color=c-&gt;nothing))</code></pre><h4 id="Threshold-selection-1"><a class="docs-heading-anchor" href="#Threshold-selection-1">Threshold selection</a><a class="docs-heading-anchor-permalink" href="#Threshold-selection-1" title="Permalink"></a></h4><p>TODO</p><h4 id="GPD-parameters-estimation-1"><a class="docs-heading-anchor" href="#GPD-parameters-estimation-1">GPD parameters estimation</a><a class="docs-heading-anchor-permalink" href="#GPD-parameters-estimation-1" title="Permalink"></a></h4><p>Let&#39;s first identify the threshold exceedances:</p><pre><code class="language-julia">threshold = 30.0
df = filter(row -&gt; row.Rainfall &gt; threshold, data)
first(df, 5)</code></pre><table class="data-frame"><thead><tr><th></th><th>Rainfall</th></tr><tr><th></th><th>Float64</th></tr></thead><tbody><p>5 rows × 1 columns</p><tr><th>1</th><td>31.8</td></tr><tr><th>2</th><td>32.5</td></tr><tr><th>3</th><td>31.8</td></tr><tr><th>4</th><td>44.5</td></tr><tr><th>5</th><td>30.5</td></tr></tbody></table><p>Get the exceedances above the threshold:</p><pre><code class="language-julia">df[!,:Rainfall] =  df[!,:Rainfall] .- threshold
rename!(df, :Rainfall =&gt; :Exceedance)
first(df, 5)</code></pre><table class="data-frame"><thead><tr><th></th><th>Exceedance</th></tr><tr><th></th><th>Float64</th></tr></thead><tbody><p>5 rows × 1 columns</p><tr><th>1</th><td>1.8</td></tr><tr><th>2</th><td>2.5</td></tr><tr><th>3</th><td>1.8</td></tr><tr><th>4</th><td>14.5</td></tr><tr><th>5</th><td>0.5</td></tr></tbody></table><p>Generalized Pareto parameter estimation by maximum likelihood:</p><pre><code class="language-julia-repl">julia&gt; fm = gpfit(df, :Exceedance)
MaximumLikelihoodEVA
model :
	ThresholdExceedance
	data :		Array{Float64,1}[152]
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

θ̂  :	[2.006896498380506, 0.1844926991237574]</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The function returns the estimates of the log-scale parameter <span>$\phi = \log \sigma$</span>.</p></div></div><h4 id="Return-level-estimation-2"><a class="docs-heading-anchor" href="#Return-level-estimation-2">Return level estimation</a><a class="docs-heading-anchor-permalink" href="#Return-level-estimation-2" title="Permalink"></a></h4><p>With the <a href="../functions/#Extremes.ThresholdExceedance-Tuple{Variable}"><code>ThresholdExceedance</code></a> structure, the <a href="../functions/#Extremes.returnlevel"><code>returnlevel</code></a> function requires several arguments to calculate the <em>T</em>-year return level:</p><ul><li>the threshold value;</li><li>the number of total observation (below and above the threshold);</li><li>the number of observations per year;</li><li>the return period <em>T</em>;</li><li>the confidence level for computing the confidence interval.</li></ul><p>The function uses the Peaks-Over-Threshold model definition (Coles, 2001, Chapter 4) for computing the <em>T</em>-year return level.</p><p>For the rainfall example, the 100-year return level can be estimated as follows:</p><pre><code class="language-julia-repl">julia&gt; r = returnlevel(fm, threshold, size(data,1), 365, 100, .95)
ReturnLevel(MaximumLikelihoodEVA
model :
	ThresholdExceedance
	data :		Array{Float64,1}[152]
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

θ̂  :	[2.006896498380506, 0.1844926991237574]
, 100, [106.32558691303024], [[65.48163774428642, 147.16953608177405]])</code></pre><p>where the value can be accessed with</p><pre><code class="language-julia-repl">julia&gt; r.value
1-element Array{Float64,1}:
 106.32558691303024</code></pre><p>and where the corresponding confidence interval can be accessed with</p><pre><code class="language-julia-repl">julia&gt; r.cint
1-element Array{Array{Float64,1},1}:
 [65.48163774428642, 147.16953608177405]</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>In this example of a stationary model, the function returns a unit dimension vector for the return level and a vector containing only one vector for the confidence interval. The reason is that the function always returns the same type in the stationary and non-stationary case. The function is therefore <a href="https://docs.julialang.org/en/v1/manual/performance-tips/index.html#Write-%22type-stable%22-functions-1">type-stable</a> allowing better performance of code execution.  </p></div></div><p>To get the scalar return level in the stationary case, the following command can be used:</p><pre><code class="language-julia-repl">julia&gt; r.value[]
106.32558691303024</code></pre><p>To get the scalar confidence interval in the stationary case, the following command can be used:</p><pre><code class="language-julia-repl">julia&gt; r.cint[]
2-element Array{Float64,1}:
  65.48163774428642
 147.16953608177405</code></pre><h4 id="Probability-weighted-moments-estimation-2"><a class="docs-heading-anchor" href="#Probability-weighted-moments-estimation-2">Probability weighted moments estimation</a><a class="docs-heading-anchor-permalink" href="#Probability-weighted-moments-estimation-2" title="Permalink"></a></h4><p>Probability weighted moments estimation of the GEV parameters can also be performed by using the <a href="../functions/#Extremes.gevfitpwm-Tuple{Array{#s67,1} where #s67&lt;:Real}"><code>gevfitpwm</code></a> function. All the methods also apply to the <code>pwmEVA</code> object.</p><pre><code class="language-julia-repl">julia&gt; fm = gpfitpwm(df, :Exceedance)
ERROR: MethodError: no method matching gpfitpwm(::DataFrame, ::Symbol)</code></pre><h4 id="Bayesian-estimation-2"><a class="docs-heading-anchor" href="#Bayesian-estimation-2">Bayesian estimation</a><a class="docs-heading-anchor-permalink" href="#Bayesian-estimation-2" title="Permalink"></a></h4><p>Bayesian estimation of the GEV parameters can also be performed by using the <a href="../functions/#Extremes.gevfitbayes-Tuple{Array{#s15,1} where #s15&lt;:Real}"><code>gevfitbayes</code></a> function. All the methods also apply to the `BayesianEVA object.</p><pre><code class="language-julia-repl">julia&gt; fm = gpfitbayes(df, :Exceedance)
Progress:  11%|████▍                                    |  ETA: 0:00:01[KProgress:  23%|█████████▌                               |  ETA: 0:00:01[KProgress:  38%|███████████████▍                         |  ETA: 0:00:01[KProgress:  50%|████████████████████▋                    |  ETA: 0:00:00[KProgress:  63%|█████████████████████████▉               |  ETA: 0:00:00[KProgress:  77%|███████████████████████████████▊         |  ETA: 0:00:00[KProgress:  90%|████████████████████████████████████▉    |  ETA: 0:00:00[KProgress: 100%|█████████████████████████████████████████| Time: 0:00:00[K
BayesianEVA
model :
	ThresholdExceedance
	data :		Array{Float64,1}[152]
	logscale :	ϕ ~ 1
	shape :		ξ ~ 1

sim :	Mamba.Chains</code></pre><h2 id="Model-for-dependent-data-1"><a class="docs-heading-anchor" href="#Model-for-dependent-data-1">Model for dependent data</a><a class="docs-heading-anchor-permalink" href="#Model-for-dependent-data-1" title="Permalink"></a></h2><p>Coles(2001, Chapter 5)</p><h2 id="Model-for-non-stationary-data-1"><a class="docs-heading-anchor" href="#Model-for-non-stationary-data-1">Model for non-stationary data</a><a class="docs-heading-anchor-permalink" href="#Model-for-non-stationary-data-1" title="Permalink"></a></h2><p>Coles(2001, Chapter 6)</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Extreme value analysis in Julia.</a><a class="docs-footer-nextpage" href="../contributing/">Contributing »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 25 June 2020 16:08">Thursday 25 June 2020</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
